# encoding: utf-8

module Constants
  JSON_VALIDATOR_RE = /(
         # define subtypes and build up the json syntax, BNF-grammar-style
         # The {0} is a hack to simply define them as named groups here but not match on them yet
         # I added some atomic grouping to prevent catastrophic backtracking on invalid inputs
         (?<number>  -?(?=[1-9]|0(?!\d))\d+(\.\d+)?([eE][+-]?\d+)?){0}
         (?<boolean> true | false | null ){0}
         (?<string>  " (?>[^"\\\\]* | \\\\ ["\\\\bfnrt\/] | \\\\ u [0-9a-f]{4} )* " ){0}
         (?<array>   \[ (?> \g<json> (?: , \g<json> )* )? \s* \] ){0}
         (?<pair>    \s* \g<string> \s* : \g<json> ){0}
         (?<object>  \{ (?> \g<pair> (?: , \g<pair> )* )? \s* \} ){0}
         (?<json>    \s* (?> \g<number> | \g<boolean> | \g<string> | \g<array> | \g<object> ) \s* ){0}
       )
    \A \g<json> \Z
    /uix
end

########## inline test running
if __FILE__==$PROGRAM_NAME

  # support
  class String
    def unindent
      gsub(/^#{scan(/^(?!\n)\s*/).min_by{|l|l.length}}/u, "")
    end
  end

  require 'test/unit' unless defined? Test::Unit
  class JsonValidationTest < Test::Unit::TestCase
    include Constants

    def setup

    end

    def test_json_validator_simple_string
      assert_not_nil %s[ {"somedata": 5 }].match(JSON_VALIDATOR_RE)
    end

    def test_json_validator_deep_string
      long_json = <<-JSON.unindent
      {
          "glossary": {
              "title": "example glossary",
          "GlossDiv": {
                  "id": 1918723,
                  "boolean": true,
                  "title": "S",
            "GlossList": {
                      "GlossEntry": {
                          "ID": "SGML",
                "SortAs": "SGML",
                "GlossTerm": "Standard Generalized Markup Language",
                "Acronym": "SGML",
                "Abbrev": "ISO 8879:1986",
                "GlossDef": {
                              "para": "A meta-markup language, used to create markup languages such as DocBook.",
                  "GlossSeeAlso": ["GML", "XML"]
                          },
                "GlossSee": "markup"
                      }
                  }
              }
          }
      }
      JSON

      retardedly_long_json = "{\"session_invalidation\":{\"from\":\"AuthenticationsController#handle_unverified_request\",\"reason\":\"csrf_token_invalid\",\"remote_ip\":\"24.34.158.169\",\"params\":{\"domain\":\"aline.com\",\"controller\":\"authentications\",\"action\":\"create\",\"provider\":\"google_apps\"},\"request_url\":\"https://aline.desk.com/login/google_apps/callback?domain=aline.com\",\"referer\":\"/\",\"user_agent\":\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\",\"cookies\":{\"hsfirstvisit\":\"https://aline.desk.com/home||2012-04-18 15:19:47\",\"__hstc\":\"210068362.29f0f5dab5c08f56b46cee177095f334.1337368787649.1337606424674.1337631137238.3\",\"hubspotutk\":\"29f0f5dab5c08f56b46cee177095f334\",\"__ptca\":\"210068362.Ff8aBGmGGFnx.1332445189.1337620825.1337645537.98\",\"__ptv_4rUruV\":\"Ff8aBGmGGFnx\",\"__pti_4rUruV\":\"Ff8aBGmGGFnx\",\"__ptcz\":\"210068362.1332445189.1.0.ptmcsr=(direct)|ptmcmd=(none)|ptmccn=(direct)\",\"user_credentials\":\"8c87e247b506677de46de92bf87d95efeadca4ae2f408f6eed1644824e4f61703cdc4737ce4b06d3fcb19fe5d30ff28c0b73fdb7dab41cc33329675c8f347ff0::10030989\",\"multitouch\":\"direct / none\",\"user_segment\":\"Paid Admin\",\"__utma\":\"91350927.973625454.1332430789.1340654762.1340740184.157\",\"__utmc\":\"91350927\",\"__utmz\":\"91350927.1332430789.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)\",\"__utmv\":\"91350927.Paid+Admin\",\"__ar_v4\":\"G6JWZIJBKRAMNOKRRWTX2L:20120622:7|ONE5IC5OY5DD3BPAKIUHHJ:20120622:14|LP3ED7PIZRHCHGYHAXF72M:20120622:14|BHAIUXG5XJEDJIMP2R6Z2B:20120622:7\",\"_assistly_session\":\"BAh7DEkiFXVzZXJfY3JlZGVudGlhbHMGOgZFRkkiAYA4Yzg3ZTI0N2I1MDY2NzdkZTQ2ZGU5MmJmODdkOTVlZmVhZGNhNGFlMmY0MDhmNmVlZDE2NDQ4MjRlNGY2MTcwM2NkYzQ3MzdjZTRiMDZkM2ZjYjE5ZmU1ZDMwZmYyOGMwYjczZmRiN2RhYjQxY2MzMzMyOTY3NWM4ZjM0N2ZmMAY7AFRJIhh1c2VyX2NyZWRlbnRpYWxzX2lkBjsARmkDjQ+ZSSIVY3VycmVudF9sb2dpbl9hdAY7AEZVOiBBY3RpdmVTdXBwb3J0OjpUaW1lV2l0aFpvbmVbCEl1OglUaW1lDVMXHMD7rLTHCToLQF96b25lSSIIVVRDBjsAVDoNbmFub19udW1pAoEBOg1uYW5vX2RlbmkGOg1zdWJtaWNybyIHOFBJIghVVEMGOwBGQA5JIg9zZXNzaW9uX2lkBjsARiIlNTZiOGJhMjE5N2M0NzM4MzkwMmY2ZDcxN2Q1N2Y5NTNJIhBfY3NyZl90b2tlbgY7AEZJIjFob0pkaExBb3JPalQ4djBNQXRLWm9uemh2STg3TGlEYUhvTzUwa091V2JzPQY7AEZJIj1PcGVuSUQ6OkNvbnN1bWVyOjpEaXNjb3ZlcmVkU2VydmljZXM6Ok9wZW5JRDo6Q29uc3VtZXI6OgY7AEZvOilPcGVuSUQ6OkNvbnN1bWVyOjpEaXNjb3ZlcmVkU2VydmljZXMJOhJAc3RhcnRpbmdfdXJsSSIOYWxpbmUuY29tBjsARjoPQHlhZGlzX3VybEAWOg5Ac2VydmljZXNbADoNQGN1cnJlbnRvOiJPcGVuSUQ6Ok9wZW5JRFNlcnZpY2VFbmRwb2ludAw6EEBjbGFpbWVkX2lkMDoQQHNlcnZlcl91cmxJIjNodHRwczovL3d3dy5nb29nbGUuY29tL2EvYWxpbmUuY29tL284L3VkP2JlPW84BjsAVDoPQHR5cGVfdXJpc1sKSSIsaHR0cDovL3NwZWNzLm9wZW5pZC5uZXQvYXV0aC8yLjAvc2VydmVyBjsAVEkiIWh0dHA6Ly9vcGVuaWQubmV0L3Nydi9heC8xLjAGOwBUSSI5aHR0cDovL3NwZWNzLm9wZW5pZC5uZXQvZXh0ZW5zaW9ucy91aS8xLjAvbW9kZS9wb3B1cAY7AFRJIjNodHRwOi8vc3BlY3Mub3BlbmlkLm5ldC9leHRlbnNpb25zL3VpLzEuMC9pY29uBjsAVEkiMGh0dHA6Ly9zcGVjcy5vcGVuaWQubmV0L2V4dGVuc2lvbnMvcGFwZS8xLjAGOwBUOg5AbG9jYWxfaWQwOhJAY2Fub25pY2FsX2lkMDoQQHVzZWRfeWFkaXNUOhhAZGlzcGxheV9pZGVudGlmaWVyMEkiLk9wZW5JRDo6Q29uc3VtZXI6Omxhc3RfcmVxdWVzdGVkX2VuZHBvaW50BjsARkAY--3f5852a6d39267bf34f7ba4ffb6e37522db6f9f2\"},\"session\":{\"user_credentials\":\"8c87e247b506677de46de92bf87d95efeadca4ae2f408f6eed1644824e4f61703cdc4737ce4b06d3fcb19fe5d30ff28c0b73fdb7dab41cc33329675c8f347ff0\",\"user_credentials_id\":10030989,\"current_login_at\":\"2012-06-26T19:49:59Z\",\"session_id\":\"56b8ba2197c47383902f6d717d57f953\",\"_csrf_token\":\"hoJdhLAorOjT8v0MAtKZonzhvI87LiDaHoO50kOuWbs=\",\"OpenID::Consumer::DiscoveredServices::OpenID::Consumer::\":null,\"OpenID::Consumer::last_requested_endpoint\":null},\"current_host_pid\":\"web1.internal.desk.com-10231\",\"stacktrace\":[\"/var/assistly/releases/20120623055034/config/initializers/extended_request_logging.rb:54:in `trace_session_invalidation'\",\"/var/assistly/releases/20120623055034/app/controllers/application_controller.rb:72:in `handle_unverified_request'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_controller/metal/request_forgery_protection.rb:94:in `verify_authenticity_token'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activesupport-3.0.14/lib/active_support/callbacks.rb:432:in `_run__629607029497222774__process_action__4158728047374871154__callbacks'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activesupport-3.0.14/lib/active_support/callbacks.rb:410:in `_run_process_action_callbacks'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activesupport-3.0.14/lib/active_support/callbacks.rb:94:in `run_callbacks'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/abstract_controller/callbacks.rb:17:in `process_action'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_controller/metal/rescue.rb:17:in `process_action'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_controller/metal/instrumentation.rb:30:in `block in process_action'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activesupport-3.0.14/lib/active_support/notifications.rb:52:in `block in instrument'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activesupport-3.0.14/lib/active_support/notifications/instrumenter.rb:21:in `instrument'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activesupport-3.0.14/lib/active_support/notifications.rb:52:in `instrument'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_controller/metal/instrumentation.rb:29:in `process_action'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/newrelic_rpm-3.3.5/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:34:in `block in process_action'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/newrelic_rpm-3.3.5/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:257:in `block in perform_action_with_newrelic_trace'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/newrelic_rpm-3.3.5/lib/new_relic/agent/method_tracer.rb:242:in `trace_execution_scoped'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/newrelic_rpm-3.3.5/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:252:in `perform_action_with_newrelic_trace'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/newrelic_rpm-3.3.5/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:33:in `process_action'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/abstract_controller/base.rb:119:in `process'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/abstract_controller/rendering.rb:41:in `process'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_controller/metal.rb:138:in `dispatch'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_controller/metal.rb:178:in `block in action'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/routing/route_set.rb:68:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/routing/route_set.rb:68:in `dispatch'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/routing/route_set.rb:33:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-mount-0.6.14/lib/rack/mount/route_set.rb:148:in `block in call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-mount-0.6.14/lib/rack/mount/code_generation.rb:93:in `block in recognize'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-mount-0.6.14/lib/rack/mount/code_generation.rb:68:in `optimized_each'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-mount-0.6.14/lib/rack/mount/code_generation.rb:92:in `recognize'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-mount-0.6.14/lib/rack/mount/route_set.rb:139:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/routing/route_set.rb:499:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/newrelic_rpm-3.3.5/lib/new_relic/rack/browser_monitoring.rb:12:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rakismet-1.2.1/lib/rakismet/middleware.rb:10:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/agent_poll_rack.rb:92:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/ticket_filter_rack.rb:53:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/ip_auth_rack.rb:29:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/check_http_host_rack.rb:13:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/site_cache_rack.rb:14:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-cache-1.1/lib/rack/cache/context.rb:132:in `forward'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-cache-1.1/lib/rack/cache/context.rb:139:in `pass'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-cache-1.1/lib/rack/cache/context.rb:151:in `invalidate'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-cache-1.1/lib/rack/cache/context.rb:70:in `call!'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-cache-1.1/lib/rack/cache/context.rb:50:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/oa-core-0.2.6/lib/omniauth/strategy.rb:164:in `call_app!'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/oa-core-0.2.6/lib/omniauth/strategy.rb:129:in `callback_phase'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/oa-openid-0.2.6/lib/omniauth/strategies/open_id.rb:89:in `callback_phase'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/oa-core-0.2.6/lib/omniauth/strategy.rb:68:in `callback_call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/oa-core-0.2.6/lib/omniauth/strategy.rb:42:in `call!'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/oa-core-0.2.6/lib/omniauth/strategy.rb:30:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/oa-core-0.2.6/lib/omniauth/builder.rb:30:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/sass-3.1.4/lib/sass/plugin/rack.rb:54:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/best_standards_support.rb:17:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/head.rb:14:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-1.2.5/lib/rack/methodoverride.rb:24:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/params_parser.rb:21:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/flash.rb:182:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/session/abstract_store.rb:149:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/cookies.rb:302:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/set_cookie_secure.rb:9:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/rack_cache_cookie_filter.rb:7:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activerecord-3.0.14/lib/active_record/query_cache.rb:32:in `block in call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activerecord-3.0.14/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activerecord-3.0.14/lib/active_record/query_cache.rb:12:in `cache'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activerecord-3.0.14/lib/active_record/query_cache.rb:31:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activerecord-3.0.14/lib/active_record/connection_adapters/abstract/connection_pool.rb:354:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/callbacks.rb:46:in `block in call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/activesupport-3.0.14/lib/active_support/callbacks.rb:416:in `_run_call_callbacks'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/callbacks.rb:44:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-1.2.5/lib/rack/sendfile.rb:106:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/remote_ip.rb:48:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/new_relic_exception_logging_rack.rb:7:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/show_exceptions.rb:47:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/railties-3.0.14/lib/rails/rack/logger.rb:13:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-1.2.5/lib/rack/runtime.rb:17:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-1.2.5/lib/rack/lock.rb:13:in `block in call'\",\"<internal:prelude>:10:in `synchronize'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/rack-1.2.5/lib/rack/lock.rb:13:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/actionpack-3.0.14/lib/action_dispatch/middleware/static.rb:30:in `call'\",\"/var/assistly/releases/20120623055034/app/middlewares/timeout_rack.rb:10:in `block in call'\",\"/home/ubuntu/.rvm/rubies/ruby-1.9.3-p194/lib/ruby/1.9.1/timeout.rb:68:in `timeout'\",\"/var/assistly/releases/20120623055034/app/middlewares/timeout_rack.rb:9:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/railties-3.0.14/lib/rails/application.rb:168:in `call'\",\"/var/assistly/shared/bundle/ruby/1.9.1/gems/railties-3.0.14/lib/rails/application.rb:77:in `method_missing'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/rack/request_handler.rb:96:in `process_request'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_request_handler.rb:516:in `accept_and_process_next_request'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_request_handler.rb:274:in `main_loop'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/rack/application_spawner.rb:206:in `start_request_handler'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/rack/application_spawner.rb:171:in `block in handle_spawn_application'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/utils.rb:479:in `safe_fork'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/rack/application_spawner.rb:166:in `handle_spawn_application'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server.rb:357:in `server_main_loop'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server.rb:206:in `start_synchronously'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server.rb:180:in `start'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/rack/application_spawner.rb:129:in `start'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/spawn_manager.rb:253:in `block (2 levels) in spawn_rack_application'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server_collection.rb:132:in `lookup_or_add'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/spawn_manager.rb:246:in `block in spawn_rack_application'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server_collection.rb:82:in `block in synchronize'\",\"<internal:prelude>:10:in `synchronize'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server_collection.rb:79:in `synchronize'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/spawn_manager.rb:244:in `spawn_rack_application'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/spawn_manager.rb:137:in `spawn_application'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/spawn_manager.rb:275:in `handle_spawn_application'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server.rb:357:in `server_main_loop'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/lib/phusion_passenger/abstract_server.rb:206:in `start_synchronously'\",\"/home/ubuntu/.rvm/gems/ruby-1.9.3-p194@desk-rails3/gems/passenger-3.0.13/helper-scripts/passenger-spawn-server:99:in `<main>'\"]}}"



      assert_not_nil long_json.match(JSON_VALIDATOR_RE)
      assert_not_nil retardedly_long_json.match(JSON_VALIDATOR_RE)
    end

  end
end